<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{{ fantasy_name }}</title>

  <!-- DataTables CSS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.8/css/jquery.dataTables.min.css"/>
  <link rel="stylesheet" href="https://cdn.datatables.net/fixedcolumns/4.3.0/css/fixedColumns.dataTables.min.css"/>
  <link rel="stylesheet" href="https://cdn.datatables.net/fixedheader/3.4.0/css/fixedHeader.dataTables.min.css"/>
  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css"/>

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

  <!-- DataTables JS -->
  <script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/fixedcolumns/4.3.0/js/dataTables.fixedColumns.min.js"></script>
  <script src="https://cdn.datatables.net/fixedheader/3.4.0/js/dataTables.fixedHeader.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.print.min.js"></script>

  <style>
    body {
    display: flex;
    flex-direction: column; /* stack things vertically */
    justify-content: center;
    align-items: center;
    min-height: 100vh; /* full viewport height */
    margin: 0;
    font-family: Arial, sans-serif;
    }
    .tabs {
        display: flex;
        justify-content: center;
        flex-wrap: wrap; /* wrap if too many tabs */
        margin-bottom: 20px;
    }
    .tab-button {
      background-color: #f1f1f1;
      float: left;
      border: none;
      outline: none;
      cursor: pointer;
      padding: 10px 20px;
      margin-right: 2px;
      font-size: 16px;
    }
    .tab-button.active { background-color: #ccc; }
    .tab-content {
    display: none;       /* hide inactive tabs */
    width: 95%;
    max-width: 1200px;   /* optional max width */
    margin: 0 auto;      /* center horizontally */
}
.tab-content.active {
    display: block;      /* show only active tab */
}
.tab-content table {
    width: 100% !important; /* table fills the container */
    margin: 0 auto;         /* center table horizontally */
}
    /* DataTables buttons styling */
    .dt-button {
      border-radius: 5px !important;
}
  </style>
</head>
<body>

<h1>{{ fantasy_name }}</h1>

<!-- Tab Buttons -->
<div class="tabs">
  {% for sheet_name in sheets.keys() %}
    <button class="tab-button {% if loop.first %}active{% endif %}" data-tab="tab_{{ loop.index0 }}">{{ sheet_name }}</button>
  {% endfor %}
</div>

<!-- Tab Contents -->
{% for sheet_name, sheet in sheets.items() %}
  <div id="tab_{{ loop.index0 }}" class="tab-content {% if loop.first %}active{% endif %}">
    <table id="table_{{ loop.index0 }}" class="display nowrap" style="width:100%">
      <thead>
        <tr>
          {% for col in sheet.columns %}
            <th>{{ col }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for row in sheet.rows %}
          <tr>
            {% for cell in row %}
              {% if cell is number %}
                {% if cell != cell %}  {# NaN #}
                  <td data-order="-999999999"></td>
                {% else %}
                  <td data-order="{{ cell }}">{{ cell }}</td>
                {% endif %}
              {% else %}
                <td data-order="{{ cell | string | lower }}">{{ cell }}</td>
              {% endif %}
            {% endfor %}
          </tr>
        {% endfor %}
      </tbody>
    </table>
    <br>
  </div>
{% endfor %}

<script>
$(document).ready(function () {

  // --- Tab switching ---
  $('.tab-button').click(function() {
    var tabId = $(this).data('tab');
    $('.tab-button').removeClass('active');
    $(this).addClass('active');
    $('.tab-content').removeClass('active');
    $('#' + tabId).addClass('active');
  });

  // --- Initialize DataTables for each sheet ---
  {% for sheet_name, sheet in sheets.items() %}
    var table_{{ loop.index0 }} = $('#table_{{ loop.index0 }}').DataTable({
      scrollX: true,
      scrollY: '400px',
      scrollCollapse: false,
      paging: false,
      dom: 'Bfrtip',
      buttons: [
        {
          extend: 'csvHtml5',
          text: 'Download CSV',
          title: '{{ fantasy_name }}_{{ sheet_name }}',
          exportOptions: { columns: ':visible' }
        }
      ]
    });

    new $.fn.dataTable.FixedHeader(table_{{ loop.index0 }});
  {% endfor %}

});
</script>
</body>
</html>
